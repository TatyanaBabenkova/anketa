<input type="hidden" name="train_id" id="train_id" value="944">

    <div class="section">
        <h3>Данные о поездке</h3>
        
        <label>В каком типе вагона Вы совершаете поездку?</label>
        <div class="option-group">
            <label><input type="radio" name="wagon_type" value="Купе"> Купе</label>
            <label><input type="radio" name="wagon_type" value="СВ"> СВ</label>
        </div>

        <div style="display: flex; gap: 20px;">
            <div style="flex:1;">
                <label for="wagon_num">Номер вагона</label>
                <input type="text" id="wagon_num" name="wagon_num" placeholder="Например: 05">
            </div>
            <div style="flex:1;">
                <label for="place_num">Номер места</label>
                <input type="text" id="place_num" name="place_num" placeholder="Например: 12">
            </div>
        </div>
    </div>

<script>
    // 1. ФУНКЦИЯ АВТОЗАПОЛНЕНИЯ ПРИ ЗАГРУЗКЕ
    window.addEventListener('DOMContentLoaded', () => {
        // Получаем параметры из адресной строки (URL)
        const params = new URLSearchParams(window.location.search);

        // Попытка найти параметры 'wagon' (вагон), 'place' (место), 'train' (поезд)
        // Названия параметров зависят от того, как их отдает "Попутчик". 
        // Обычно это wagon_num, place_num или просто wagon, place.
        
        const wagon = params.get('wagon') || params.get('wagon_num');
        const place = params.get('place') || params.get('place_num');
        const train = params.get('train') || params.get('train_id');

        // Если нашли — подставляем в поля
        if (wagon) {
            document.getElementById('wagon_num').value = wagon;
            // Можно сделать поле неактивным, чтобы не исправляли, если это нужно:
            // document.getElementById('wagon_num').readOnly = true; 
        }

        if (place) {
            document.getElementById('place_num').value = place;
        }

        if (train) {
            document.getElementById('train_id').value = train;
        }
    });

    // 2. ОТПРАВКА ФОРМЫ (как и было раньше)
    document.getElementById('kareliaSurvey').addEventListener('submit', function(e) {
        e.preventDefault();
        const formData = new FormData(this);
        const data = {};
        
        formData.forEach((value, key) => {
            if (data[key]) {
                if (!Array.isArray(data[key])) {
                    data[key] = [data[key]];
                }
                data[key].push(value);
            } else {
                data[key] = value;
            }
        });

        data['date_filled'] = new Date().toISOString();

        console.log("JSON для отправки:", JSON.stringify(data, null, 2));
        alert("Данные собраны! В консоли (F12) виден JSON с заполненными номером вагона и места.");
    });
</script>
